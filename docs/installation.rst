Installation
************

The model checker can be run in two configurations, *REST API* and *CLI*.

First, you'll need to install the dependencies to run this tool.

Installing the dependencies
===========================

This project is packaged with `Poetry`_, so you should install it first.

Once *Poetry* has been installed, install the dependencies with::
  
  poetry install


Run locally for testing
-----------------------
Run with::

  poetry run python -m mc_openapi

This command serves the APIs through a `Flask`_ instance,
which is suitable for testing, but not recommended for production.

Run locally with Uvicorn
------------------------

The project may be run with `Uvicorn`_,
which is better-suited for production environments, as follows::

  uvicorn --port 8080 --host 0.0.0.0 --interface wsgi --workers 2 mc_openapi.app_config:app

You may also configure Uvicorn using environment variables
with the prefix ``UVICORN_``.
For example, if you want to run the server with 4 workers,
set the environment variable ``UVICORN_WORKERS`` to ``4``.

Run with Docker
---------------

The best way of deploying the DOML Model Checker is by using `Docker`_.

First, build the docker image with the usual::

  docker build -t wp4/dmc .

And then run it with::

  docker run -d wp4/dmc

The Uvicorn server will be running and listening on port 80 of the container.
To use it locally, you may e.g. bind it with port 8080 of ``localhost``
by adding ``-p 127.0.0.1:8080:80/tcp`` to the ``docker run`` command.

REST API Endpoints
==================

You may read the API specification generated by `Swagger-UI`_ at http://127.0.0.1:8080/ui/.

Building the Documentation
==========================

The documentation has been written in `Sphinx`_.

To build it, type::

  poetry shell

and then::

  cd docs
  make html

The documentation will be generated in ``docs/_build``.


.. _Poetry: https://python-poetry.org/
.. _Flask: https://flask.palletsprojects.com/
.. _Swagger-UI: https://swagger.io/tools/swagger-ui/
.. _Uvicorn: https://www.uvicorn.org/
.. _Docker: https://www.docker.com/
.. _Sphinx: https://www.sphinx-doc.org/
